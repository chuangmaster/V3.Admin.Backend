# 重構 User 模組
為了模組更好被識別，將調整命名規範，將 User 表單進行重構，將原本的 username，重新命名為 Account
，並且調整相關的欄位名稱與邏輯。(包含後端的 Repository、Service、Controller)
1. migration: 調整資料庫欄位名稱
2. 確保 API response 中的欄位名稱也做相應調整 

# 修改密碼模組重構

## 問題分析

目前的密碼變更 API 混淆了兩種不同的使用場景：
1. **用戶自己修改密碼**：需要驗證舊密碼（安全考量）
2. **管理者重設他人密碼**：不需要舊密碼（基於權限管理）

## 設計方案：分離成兩個獨立 API

### API 1: 用戶修改自己的密碼
- **路徑**: `PUT /api/account/me/password`
- **需要舊密碼**: ✅ 是
- **需要權限**: `user.profile.update`
- **用途**: 用戶驗證身份後修改自己的密碼

### API 2: 管理者重設他人密碼
- **路徑**: `PUT /api/account/{id}/reset-password`
- **需要舊密碼**: ❌ 否
- **需要權限**: `user.password.reset`
- **用途**: 管理者直接重設指定用戶的密碼
- **審計**: 必須記錄操作者和被操作者

## 併發控制

為確保併發問題的處理，Request 必須包含 `version` 欄位（放在 request body 中），後端會根據 version 來判斷是否有併發衝突。

### 用戶修改自己的密碼 Request
```json
{
  "oldPassword": "old_password",
  "newPassword": "new_password",
  "version": 2
}
```

### 管理者重設密碼 Request
```json
{
  "newPassword": "new_password",
  "version": 2
}
```

## 安全性考量

1. **審計日誌**: 管理者重設密碼應該記錄操作者 ID 和被操作者 ID
2. **權限檢查**: 需要新增 `user.password.reset` 權限

## 實作項目

### 1. 新增 Models
- `ResetPasswordRequest.cs` - 管理者重設密碼請求模型
- `ResetPasswordDto.cs` - Service 層使用的 DTO

### 2. 修改 Service
- 新增 `ResetPasswordAsync(ResetPasswordDto dto)` 方法
- 移除 `ChangePasswordAsync(ChangePasswordDto dto)` 方法

### 3. 修改 Controller
- 調整現有路徑：`PUT /api/account/{id}/password` → `PUT /api/account/me/password`
- 新增路徑：`PUT /api/account/{id}/reset-password`
- 加入權限驗證：`[RequirePermission("user.profile.update")]`(用戶自身的權限)、[RequirePermission("account.update")](管理者重設密碼的權限)`

## 補足Account權限
針對 Account 模組 #file:AccountController.cs，補足以下權限設定：
- `account.read` - 允許查詢系統帳號信息
- `account.update` - 允許修改系統帳號信息
- `account.delete` - 允許刪除系統帳號
