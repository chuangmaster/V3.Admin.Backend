# Feature Specification: 服務單管理模組

**Feature Branch**: `007-service-order-management`  
**Created**: 2025-12-16  
**Status**: Draft  
**Input**: 服務單管理模組，使用者可以透過功能，來建立、查詢、修改寄賣單與收購單

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 線下收購單建立 (Priority: P1)

店員在店內接待客戶,協助客戶建立收購單,包含拍攝身分證明文件、填寫商品資訊、簽署合約文件,完成收購流程。

**Why this priority**: 收購單是店鋪主要業務之一,必須優先實現以滿足日常營運需求。

**Independent Test**: 店員可以完整建立一筆收購單（包含客戶資料、商品項目、身分證上傳、線下簽名），並在系統中查詢到該筆記錄。

**Acceptance Scenarios**:

1. **Given** 店員開啟收購單建立表單，**When** 選擇「收購單」類型與「線下」來源，填寫客戶資料（姓名、電話、身分證字號）、商品資訊（品牌、款式、總金額）、上傳身分證照片，**Then** 系統驗證表單欄位正確後允許送出。

2. **Given** 店員完成收購單表單填寫，**When** 送出表單後，**Then** 系統產生收購合約與一時貿易申請書，店員引導客戶依序在網頁上簽名，系統儲存兩份簽名記錄並顯示建立成功訊息。

3. **Given** 店員上傳身分證照片後，**When** 點擊 ⭐ AI 辨識按鈕，**Then** 系統自動辨識身分證字號與姓名，並以身分證字號搜尋既有客戶。若找到既有客戶則自動選擇並填入客戶資訊；若找不到則將辨識結果填入新增客戶表單供店員補充其他資訊。

4. **Given** 店員已手動選擇客戶後，**When** 點擊 ⭐ AI 辨識按鈕，**Then** 系統比對辨識的身分證字號與已選擇客戶的身分證字號，若不一致則顯示錯誤訊息並要求重新選擇客戶或重新上傳身分證，不允許繼續建單。

5. **Given** 店員新增多個商品項目（1-4 件），**When** 每個商品項目填寫品牌名稱與款式，**Then** 系統顯示當前商品總件數並允許新增、編輯、刪除商品項目，最少保留 1 件，最多允許 4 件。

---

### User Story 2 - 線下寄賣單建立 (Priority: P1)

店員協助客戶建立寄賣單,填寫商品資訊（包含配件與瑕疵）、設定寄賣日期與續約選項、拍攝身分證明文件、簽署寄賣合約書。

**Why this priority**: 寄賣單與收購單同為核心業務,必須同步實現以支援完整的店鋪營運。

**Independent Test**: 店員可以完整建立一筆寄賣單（包含商品配件、瑕疵資訊、寄賣日期、續約設定、身分證上傳、線下簽名），並在系統中查詢到該筆記錄。

**Acceptance Scenarios**:

1. **Given** 店員開啟寄賣單建立表單，**When** 選擇「寄賣單」類型與「線下」來源，填寫客戶資料、商品資訊（品牌、款式、配件、瑕疵處）、寄賣日期（起訖日期，預設結束日期為起始日期後 3 個月）、續約設定、總金額、上傳身分證照片，**Then** 系統驗證表單欄位正確後允許送出。

2. **Given** 店員完成寄賣單表單填寫，**When** 送出表單後，**Then** 系統產生寄賣合約書，店員引導客戶在網頁上簽名，系統儲存簽名記錄並顯示建立成功訊息。

3. **Given** 店員填寫寄賣起始日期，**When** 系統自動計算結束日期（起始日期 + 90 天），**Then** 店員可接受預設日期或手動調整，且系統驗證結束日期必須晚於起始日期。

4. **Given** 店員新增多個商品項目（1-4 件），**When** 每個商品項目填寫品牌名稱、款式、配件（多選）、瑕疵處（多選），**Then** 系統允許為每件商品獨立設定配件與瑕疵，並顯示當前商品總件數。

---

### User Story 3 - 客戶搜尋與管理 (Priority: P2)

店員在建立服務單時,透過姓名、電話、Email 或身分證字號搜尋既有客戶資料,或新增新客戶資料。

**Why this priority**: 客戶資料管理是服務單建立的前置作業,必須提供便捷的搜尋與新增功能以提升店員效率。

**Independent Test**: 店員可以使用多種關鍵字（姓名、電話、Email、身分證字號）搜尋客戶,找到客戶後自動填入服務單表單;若找不到則新增新客戶,新增後可立即使用。

**Acceptance Scenarios**:

1. **Given** 店員在服務單表單中輸入客戶姓名關鍵字（如「王小明」），**When** 點擊搜尋按鈕，**Then** 系統顯示符合條件的客戶列表（模糊搜尋），店員可點擊選擇客戶並自動填入客戶資訊。

2. **Given** 店員搜尋結果為空（找不到客戶），**When** 點擊「新增客戶」按鈕，**Then** 系統顯示新增客戶表單（姓名、電話、Email、身分證字號），店員填寫後儲存並自動選擇該客戶。

3. **Given** 店員輸入身分證字號（如「A123456789」）搜尋客戶，**When** 系統找到匹配的客戶（精確搜尋），**Then** 自動選擇該客戶並填入客戶資訊，避免重複建立客戶資料。

4. **Given** 店員新增外籍客戶資料，**When** 填寫身分證字號欄位時，**Then** 系統顯示說明文字：「台灣人士請填寫身分證字號（1 英文字母 + 9 數字）；外籍人士若居留證無統一證號或未領有居留證，請填寫：西元出生年月日(8位) + 英文姓名首字前2碼(大寫)，例：19900115JO」，並驗證格式正確性。

---

### User Story 4 - 線上服務單建立 (Priority: P3)

客戶透過線上表單建立服務單（收購單或寄賣單），系統透過 Dropbox Sign API 將合約文件寄送至客戶 Email 供簽名。

**Why this priority**: 線上服務單可擴展業務範圍,但相較於線下流程優先度較低,可在線下功能穩定後再實現。

**Independent Test**: 客戶可透過線上表單建立服務單,完成表單送出後收到簽名邀請 Email,簽署完成後店員可在系統中查詢到該筆服務單與簽名記錄。

**Acceptance Scenarios**:

1. **Given** 客戶開啟線上服務單表單，**When** 選擇「線上」來源、填寫客戶資料、商品資訊、上傳身分證照片、送出表單，**Then** 系統驗證表單欄位正確後建立服務單，並透過 Dropbox Sign API 將合約文件寄送至客戶 Email。

2. **Given** 客戶收到簽名邀請 Email，**When** 點擊 Dropbox Sign 連結並完成簽名，**Then** Dropbox Sign 透過 Webhook 通知後端，系統更新簽名記錄狀態為「已簽名」。

3. **Given** 店員查詢線上服務單詳細資訊，**When** 點擊「重新發送簽名邀請」按鈕，**Then** 系統透過 Dropbox Sign API 重新寄送簽名邀請 Email 至客戶信箱。

---

### User Story 5 - 服務單查詢與管理 (Priority: P2)

店員查詢、瀏覽已建立的服務單,包含篩選條件搜尋、查看詳細資訊、更新狀態、管理附件。

**Why this priority**: 查詢與管理功能是日常營運的必要工具,需在建立功能完成後優先實現以支援後續的服務單維護。

**Independent Test**: 店員可以透過多種篩選條件（服務單類型、客戶名稱、日期範圍、狀態）搜尋服務單,查看詳細資訊、更新狀態,並查詢稽核日誌。

**Acceptance Scenarios**:

1. **Given** 店員開啟服務單查詢介面，**When** 選擇篩選條件（服務單類型、客戶名稱、日期範圍、狀態）並點擊搜尋，**Then** 系統顯示符合條件的服務單列表（包含服務單編號、客戶名稱、商品資訊、金額、狀態），支援分頁瀏覽。

2. **Given** 店員點擊某筆服務單，**When** 進入詳細頁面，**Then** 系統顯示完整服務單資訊（客戶資料、商品項目、金額、狀態、附件列表、簽名記錄），內容為唯讀不可編輯。

3. **Given** 店員查看服務單詳細頁面的附件區域，**When** 點擊下載身分證明文件或合約文件，**Then** 系統記錄附件查看日誌（用於個資稽核）並提供檔案下載連結。

4. **Given** 店員查看服務單詳細頁面，**When** 點擊狀態更新按鈕（「標記為已完成」、「標記為待處理」、「標記為已終止」），**Then** 系統驗證狀態轉換規則（終態不可逆）並更新服務單狀態,同時透過 AuditLogService 記錄狀態變更（包含舊狀態與新狀態）。

5. **Given** 店員查看服務單詳細頁面，**When** 點擊「稽核日誌」標籤，**Then** 系統顯示該服務單的所有操作記錄（建立、查詢、狀態變更等），包含操作時間、操作者、操作類型，按時間倒序排列。

---

### Edge Cases

- 客戶身分證辨識失敗（照片模糊、光線不足）時,系統顯示錯誤訊息並提示店員手動輸入客戶資料。
- 店員上傳身分證照片檔案大小超過 10MB 限制時,系統顯示錯誤訊息並要求壓縮後重新上傳。
- 店員新增商品項目超過 4 件時,系統顯示錯誤訊息並禁止新增。
- 店員刪除商品項目至 0 件時,系統顯示錯誤訊息並要求保留至少 1 件商品項目。
- Dropbox Sign API 呼叫失敗（網路錯誤、API 異常）時,系統記錄錯誤日誌並顯示錯誤訊息給使用者,提供重新發送選項。
- 店員選擇「已終止」狀態後,系統不允許再變更為其他狀態（終態不可逆）。
- 店員建立寄賣單時,若寄賣結束日期早於起始日期,系統顯示驗證錯誤訊息。
- 店員上傳非圖片格式的身分證明文件（如 PDF、Word）時,系統顯示錯誤訊息並要求上傳圖片格式（JPG、PNG）。
- 辨識的身分證字號與已選擇客戶的身分證字號不一致時,系統顯示錯誤訊息並要求重新選擇客戶或重新上傳身分證。
- OCR 辨識信心度低於 0.8 時,系統顯示警告訊息提示店員確認辨識結果。
- 線下簽名時,客戶簽名資料（Base64）格式錯誤時,系統顯示錯誤訊息並要求重新簽名。
- 店員查詢服務單時,若分頁參數 pageSize 超過 100,系統返回驗證錯誤訊息。
- Dropbox Sign Webhook 請求缺少有效的 API Key 或驗證失敗時,系統拒絕請求、返回 401 Unauthorized 錯誤碼、並記錄安全警告日誌（包含來源 IP、時間戳記、請求內容）。
- Dropbox Sign Webhook 請求格式不正確或缺少必要欄位時,系統返回 400 Bad Request 錯誤碼並記錄錯誤日誌。

---

## Requirements *(mandatory)*

### Functional Requirements

#### 收購單建立

- **FR-001**: 系統必須提供收購單建立表單,包含以下必填欄位：服務單類型（收購單）、服務單來源（線上/線下）、客戶資料（選擇既有客戶或新增客戶）、至少 1 件商品項目（品牌名稱、款式）、總金額。
- **FR-002**: 商品項目支援新增、編輯、刪除功能,每個服務單最少 1 件,最多 4 件商品,每件商品包含品牌名稱（必填）、款式（必填）、內碼（選填）。
- **FR-003**: 系統必須提供身分證明文件上傳功能,僅接受圖片格式（JPG、PNG）,檔案大小限制 10MB,每筆服務單至少需要一個身分證明附件,檔案上傳至 Azure Blob Storage 並產生 SAS Token 供安全存取。
- **FR-004**: 系統必須提供拍照上傳功能,方便使用者直接用手機拍攝並上傳身分證明文件。
- **FR-005**: 系統必須在身分證預覽旁提供 ⭐ AI 辨識按鈕,點擊後透過 Azure Vision OCR 與 Google Gemini 雙重辨識身分證上的姓名與身分證字號（Azure Vision 用於文字擷取，Google Gemini 用於結構化資料解析與驗證）,並以身分證字號搜尋既有客戶。
- **FR-006**: AI 辨識後的自動搜尋流程：若找到既有客戶則自動選擇該客戶並填入客戶資訊（若辨識的姓名與客戶資料中的姓名不一致,顯示警告訊息但仍可繼續建單）;若找不到既有客戶則將辨識結果（姓名、身分證字號）自動填入新增客戶表單,店員可補充其他資訊後新增客戶。
- **FR-006-1**: 如果已經手動選擇客戶後才點擊 ⭐ 按鈕,系統必須比對辨識的身分證字號與已選擇客戶的身分證字號,若不一致則顯示錯誤訊息並要求重新選擇客戶或重新上傳身分證,不允許繼續建單。
- **FR-007**: 線下收購單送出表單後,系統必須產生收購合約與一時貿易申請書,提供網頁簽名介面（使用 SignaturePad 或類似工具）,店員引導客戶依序簽名,每次簽名結果（Base64 PNG）傳回後端儲存為簽名記錄。
- **FR-008**: 線上收購單送出表單後,系統必須透過 Dropbox Sign API 將合約文件（收購合約與一時貿易申請書）寄送至客戶 Email,供客戶進行線上簽名。
- **FR-009**: 系統必須自動產生唯一的服務單編號,格式為 `BS` + `YYYYMMDD` + 三位流水號（如 BS20251214001）,流水號使用 PostgreSQL Sequence 生成以確保並發安全與唯一性，每日重置從 001 開始。
- **FR-009-1**: 系統必須記錄服務單建立時間（createdAt）與建立者（createdBy）。

#### 寄賣單建立

- **FR-010**: 系統必須提供寄賣單建立表單,包含以下必填欄位：服務單類型（寄賣單）、服務單來源（線上/線下）、客戶資料、至少 1 件商品項目（品牌名稱、款式、商品配件、商品瑕疵處）、總金額、寄賣日期（起訖日期）、續約設定。
- **FR-011**: 寄賣單的商品項目支援多件（1-4 件）,每件商品可獨立設定配件（多選）與瑕疵處（多選）。
- **FR-012**: 寄賣日期欄位必須提供日期區間選擇器,預設結束日期為起始日期後 3 個月（90 天）,店員可手動調整,系統必須驗證結束日期晚於起始日期。
- **FR-013**: 商品配件選項包含：盒子、防塵袋、購證、提袋、肩帶、羊毛氈、枕頭、保卡、鎖頭/鑰匙、緞帶/花、品牌小卡、保證書、無（支援多選）。
- **FR-014**: 商品瑕疵處選項包含：五金生鏽/刮痕/掉、皮質磨損/刮痕/壓痕、內裡髒污、四角磨損（支援多選）。
- **FR-015**: 續約設定選項包含：到期自動取回、第三個月起自動調降 10%、屆時討論（單選）。
- **FR-016**: 寄賣單必須提供身分證明文件上傳功能（與收購單共用,僅接受圖片格式,檔案大小限制 10MB）。
- **FR-017**: 寄賣單支援 ⭐ AI 辨識功能（與收購單共用）。
- **FR-018**: 線下寄賣單送出表單後,系統必須產生寄賣合約書,提供網頁簽名介面,店員引導客戶簽名,簽名結果（Base64 PNG）傳回後端儲存為簽名記錄。
- **FR-019**: 線上寄賣單送出表單後,系統必須透過 Dropbox Sign API 將寄賣合約書寄送至客戶 Email,供客戶進行線上簽名。
- **FR-020**: 系統必須自動產生唯一的服務單編號,格式為 `CS` + `YYYYMMDD` + 三位流水號（如 CS20251214001）,流水號使用 PostgreSQL Sequence 生成以確保並發安全與唯一性，每日重置從 001 開始。
- **FR-020-1**: 系統必須記錄服務單建立時間（createdAt）與建立者（createdBy）。

#### 客戶搜尋與選擇

- **FR-021**: 系統必須提供客戶搜尋功能,支援多種關鍵字搜尋：姓名（模糊搜尋）、電話號碼（精確搜尋）、Email（模糊搜尋）、身分證字號（精確搜尋）。
- **FR-022**: 搜尋結果列表必須包含客戶基本資訊：姓名、電話號碼、Email,方便店員辨識。
- **FR-023**: 店員可點擊搜尋結果中的客戶,系統自動將客戶資訊填入服務單表單。
- **FR-024**: 若搜尋結果為空（找不到客戶）,系統必須提供「新增客戶」選項,顯示新增客戶表單（姓名、電話、Email、身分證字號）,店員填寫後儲存並自動選擇該客戶。
- **FR-024-1**: 身分證字號欄位必須提供說明文字：「台灣人士請填寫身分證字號（1 英文字母 + 9 數字）；外籍人士若居留證無統一證號或未領有居留證,請填寫：西元出生年月日(8位) + 英文姓名首字前2碼(大寫),例：19900115JO」。
- **FR-025**: 系統必須驗證身分證字號格式：台灣身分證（1 英文字母 + 9 數字）或外籍人士格式（西元出生年月日 8 位數 + 英文姓名第一個字前兩個字母大寫,總長度 10 位）。
- **FR-026**: 系統必須確保身分證字號唯一性（不允許重複建立相同身分證字號的客戶）。

#### 服務單查詢與管理

- **FR-027**: 系統必須提供服務單查詢介面,支援多種篩選條件：服務單類型（寄賣單/收購單）、客戶名稱（模糊搜尋）、日期範圍（起訖日期）、服務單狀態（待處理/已完成/已終止）。
- **FR-028**: 搜尋結果列表必須顯示服務單基本資訊：服務單編號、客戶名稱、商品資訊、金額、狀態,支援分頁瀏覽（每頁 1-100 筆,預設 20 筆）。
- **FR-029**: 店員可點擊某筆服務單進入詳細頁面,系統顯示完整服務單資訊（客戶資料、商品項目、金額、狀態、附件列表、簽名記錄）。
- **FR-030**: 系統必須提供服務單狀態更新功能,狀態選項包含：待處理（PENDING）、已完成（COMPLETED）、已終止（TERMINATED）,狀態轉換規則為終態（TERMINATED）不可逆。狀態變更將透過系統稽核日誌記錄（AuditLog）。
- **FR-031**: 服務單一經建立不允許修改內容（客戶資料、商品項目、金額等）,如需更正應建立新的服務單並註記關聯。系統使用現有的 AuditLogService 記錄所有操作（建立、查詢、狀態變更、刪除）。
- **FR-033**: 系統必須提供附件管理功能,店員可查看、下載已上傳的身分證明文件、合約文件等附件,附件儲存於 Azure Blob Storage,透過有時效性的 SAS Token 提供安全下載連結（預設有效期 1 小時）。
- **FR-034**: 系統必須記錄敏感附件（身分證明文件）的查看日誌（用於個資稽核）,每次店員查看或下載身分證明文件時自動記錄（查看時間、查看者、操作類型）。
- **FR-035**: 線上簽名的服務單必須提供「複製 Dropbox Sign 連結」與「重新發送簽名邀請」功能,店員可透過此功能追蹤簽名進度或重新寄送簽名邀請 Email。
- **FR-035-1**: 系統必須實作 Dropbox Sign Webhook 端點以接收簽名狀態更新通知,使用 API Key 驗證機制確保請求來源的合法性,驗證失敗則拒絕請求並記錄安全日誌。

#### 稽核日誌

- **FR-036**: 系統必須使用現有的 AuditLogService 記錄所有服務單相關操作,包含建立、查詢、狀態變更、刪除等操作,記錄操作者、操作時間、操作類型、目標實體等資訊。
- **FR-037**: 狀態變更操作必須記錄變更前後的狀態值（BeforeState 與 AfterState）至稽核日誌,便於追蹤服務單生命週期。

#### 權限控制

- **FR-038**: 系統必須驗證使用者權限,僅具有以下權限的使用者可執行對應操作：
  - `serviceOrder.consignment.read`：查詢寄賣單
  - `serviceOrder.consignment.create`：建立寄賣單
  - `serviceOrder.consignment.update`：修改寄賣單
  - `serviceOrder.consignment.delete`：刪除寄賣單
  - `serviceOrder.buyback.read`：查詢收購單
  - `serviceOrder.buyback.create`：建立收購單
  - `serviceOrder.buyback.update`：修改收購單
  - `serviceOrder.buyback.delete`：刪除收購單
  - `customer.read`：查詢客戶資料
  - `customer.create`：新增客戶資料
  - `serviceOrder.attachment.viewSensitive`：查看敏感附件（身分證明文件）

#### 簽名合併預覽

- **FR-039**: 系統必須提供多階段簽章流程,使用 PDFsharp 函式庫實現以下步驟:
  1. **PDF 預覽**:填充空白 PDF 模板(收購合約/寄賣合約/一時貿易申請書),將服務單欄位值定位填入,產生 PDF 預覽供店員與客戶確認
  2. **簽章捕捉**:前端顯示 PDF 預覽,在 HTML 區塊提供 SignaturePad 觸控簽章介面,客戶簽章後產生 Base64 PNG
  3. **簽章合併**:後端將 Base64 PNG 簽章定位合併到 PDF,產生已簽章的 PDF 預覽供確認
  4. **確認儲存**:店員與客戶確認無誤後,儲存最終 PDF 至 Azure Blob Storage 並建立簽名記錄。PDFsharp 需支援繁體中文字體渲染與簽章圖片定位

#### OCR 辨識規則

- **FR-040**: 系統必須支援辨識台灣身分證（1 英文字母 + 9 數字）與外籍人士居留證（若無統一證號則使用西元出生年月日 8 位數 + 英文姓名前兩字母大寫,總長度 10 位）,使用 Azure Vision OCR 進行文字擷取，再透過 Google Gemini 進行結構化解析與欄位驗證。
- **FR-041**: OCR 辨識信心度低於 0.8 時,系統必須顯示警告訊息提示店員確認辨識結果（綜合 Azure Vision 與 Gemini 的信心度評分）。
- **FR-041-1**: 系統必須實作容錯機制：若 Azure Vision 或 Google Gemini 其中一個服務無法使用，應降級使用單一服務繼續辨識，並記錄警告日誌。

#### 商品項目管理

- **FR-042**: 系統必須支援每個服務單新增 1-4 件商品項目,每件商品包含品牌名稱（必填）、款式（必填）、內碼（選填）、序號（1-4,用於顯示順序）。
- **FR-043**: 寄賣單的每件商品必須支援獨立設定配件（多選）與瑕疵處（多選）。
- **FR-044**: 系統必須在新增、編輯、刪除商品項目時顯示當前商品總件數,並限制最少 1 件、最多 4 件。

### Key Entities *(include if feature involves data)*

- **ServiceOrder（服務單）**: 核心實體,代表收購單或寄賣單,包含服務單類型、來源、客戶資料、商品項目、總金額、狀態、寄賣日期、續約設定等屬性。
- **ProductItem（商品項目）**: 代表服務單中的單一商品項目,包含品牌名稱、款式、內碼、序號、配件、瑕疵處等屬性,每個服務單可包含 1-4 件商品項目。
- **Customer（客戶）**: 記錄客戶基本資訊（姓名、電話、Email、身分證字號）,支援多種關鍵字搜尋,身分證字號必須唯一。
- **Attachment（附件）**: 儲存服務單相關文件（身分證明、合約文件等）,包含檔案名稱、檔案類型、Azure Blob Storage 路徑、檔案大小、上傳時間、內容類型等屬性,存取時透過 SAS Token 產生臨時安全連結。
- **SignatureRecord（簽名記錄）**: 記錄線下或線上簽名的完整資訊,包含簽名文件類型、簽名方式、簽名資料（Base64 PNG）或 Dropbox Sign 請求 ID、簽名者姓名、簽名時間等屬性。
- **AuditLog（稽核日誌）**: 使用系統現有的 AuditLogService 記錄所有服務單相關操作,包含建立、查詢、狀態變更、刪除等,提供完整的稽核追蹤能力。

---

## Clarifications

### Session 2025-12-16

- Q: 資料庫選擇與部署環境（本地端 PostgreSQL / Azure PostgreSQL Flexible Server / Azure SQL Database / Docker Compose PostgreSQL） → A: 本地端 PostgreSQL（開發/測試環境）
- Q: AI OCR 服務供應商選擇（Google Cloud Vision API / Azure AI Vision - OCR / AWS Textract / 開源 Tesseract OCR） → A: Azure Vision 與 Google Gemini 並用
- Q: 附件儲存方案選擇（Azure Blob Storage / 本地檔案系統 / Azure Files / 第三方 CDN + 儲存） → A: Azure Blob Storage
- Q: 服務單編號流水號生成機制（資料庫序列 Sequence / Redis 分散式鎖 + 計數器 / 應用層鎖定 / GUID/UUID） → A: 資料庫序列 Sequence- Q: PDF 合約產生與簽名合併技術方案(iText 7 / PDFsharp / Puppeteer + HTML to PDF / Azure Form Recognizer + PDF 服務 / 第三方 API) → A: PDFsharp
- Q: Dropbox Sign Webhook 端點安全驗證機制（僅使用 API Key 驗證 / HMAC 簽章驗證 + IP 白名單 / HTTPS + Bearer Token / 無特別驗證） → A: 僅使用 API Key 驗證

---

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 店員可在 3 分鐘內完成一筆收購單或寄賣單的建立（包含客戶搜尋、商品資訊填寫、身分證上傳、簽名流程）。
- **SC-002**: AI 辨識身分證的準確率達到 85% 以上（辨識成功率,信心度 ≥ 0.8）。
- **SC-003**: 客戶搜尋結果回應時間在 1 秒內完成（支援模糊搜尋與精確搜尋）。
- **SC-004**: 系統支援 100 位店員同時建立服務單,無效能衰退或資料不一致問題。
- **SC-005**: 並發更新衝突偵測準確率達到 100%（樂觀鎖機制）,避免資料覆蓋。
- **SC-006**: 服務單查詢介面支援多種篩選條件,查詢結果回應時間在 2 秒內完成（包含分頁）。
- **SC-007**: 附件查看日誌記錄完整性達到 100%（每次查看或下載敏感附件都會記錄）。
- **SC-008**: Dropbox Sign API 整合成功率達到 95% 以上（線上簽名邀請寄送成功率）。
- **SC-009**: 店員對服務單建立與查詢功能的滿意度達到 80% 以上（透過使用者訪談或問卷調查）。
- **SC-010**: 系統上線後,服務單建立錯誤率（因驗證失敗或系統錯誤導致建立失敗）低於 5%。
